# Malware Network Traffic Investigation Report

## Incident Type
Malspam-delivered malware infection with Cobalt Strike command-and-control

## Data Source
Full packet capture (PCAP) provided by network sensor

## Acknowledgment
Traffic capture credited to Brad Duncan and the InfoSec community

---

## 1. Executive Summary
On 2021-09-24, Bartell Ltdâ€™s Security Operations Center detected suspicious outbound network activity originating from the workstation of Eric Fischer (Purchasing Department). Initial investigation revealed that the user had opened a malicious Microsoft Word document received via email and enabled macros. Subsequent network analysis confirmed a multi-stage malware infection that resulted in secondary payload downloads, post-infection reconnaissance, command-and-control (C2) communications using the Cobalt Strike framework, and malicious spam (malspam) activity.

The infection leveraged multiple domains and IP addresses, employed legitimate-looking host headers for evasion, and used HTTPS-based beaconing to communicate with attacker-controlled infrastructure. This report documents the investigation findings, timeline of events, and identified indicators of compromise (IOCs).

---

## 2. Scope and Objectives

**Objectives of this investigation:**
- Identify the initial infection vector
- Determine malware payload delivery mechanisms
- Identify command-and-control infrastructure
- Detect post-infection activity and attacker objectives
- Extract indicators of compromise for defensive use

**Scope limitations:**
- Analysis limited to provided PCAP
- No direct interaction with observed domains or IP addresses

---

## 3. Initial Infection Vector

### 3.1 Malicious Email Attachment
The incident began when Eric Fischer received an email appearing to come from a known contact. The email contained a Microsoft Word document attachment. Upon opening the document, the user enabled macros by clicking **"Enable Content"**, allowing embedded malicious code to execute.

This macro execution served as the initial access mechanism for the attack.

---

## 4. Stage 1 Payload Delivery

### 4.1 ZIP File Download
Shortly after macro execution, the infected host initiated an HTTP request to download a ZIP archive:

- **File name:** documents.zip
- **Domain:** attirenepal.com
- **Protocol:** HTTP
- **Timestamp:** 2021-09-24 16:44:06 UTC

HTTP response headers confirmed the delivery of a binary file via the `content-disposition: attachment` directive.

This ZIP file is assessed to be the first-stage malware payload, likely containing a loader or executable used to establish persistence and initiate further activity.

ðŸ“¸ **Screenshot placement:** HTTP GET request and response headers showing `documents.zip` download.
<img width="1854" height="967" alt="http1" src="https://github.com/user-attachments/assets/8969e86d-0344-4b0c-924f-648ef99d0fbb" />

<img width="1854" height="967" alt="http3 stream" src="https://github.com/user-attachments/assets/b414e13e-d812-4553-b0a8-07d0dca5961f" />

---

## 5. Post-Execution Reconnaissance

### 5.1 Public IP Address Check
Following payload execution, the malware performed reconnaissance to determine the victimâ€™s public IP address. This was accomplished by querying a public IP-discovery API.

- **Domain queried:** api.ipify.org
- **Protocol:** DNS
- **Purpose:** Identify victimâ€™s public-facing IP

This behavior is commonly observed in malware to assist attackers in geolocation, victim profiling, or environment validation.

ðŸ“¸ **Screenshot placement:** DNS query packet showing `api.ipify.org`.
<img width="1854" height="967" alt="api" src="https://github.com/user-attachments/assets/e553fa15-f4e9-46a3-b40c-4eb02974c5d5" />

---

## 6. Stage 2 Payload Downloads

### 6.1 Secondary Malicious Downloads
Within the time window **16:45:11â€“16:45:30 UTC**, multiple large HTTPS transfers were observed. Analysis of TCP stream sizes revealed three domains delivering significantly larger payloads (>350 KB) compared to benign traffic.

**Domains involved:**
- finejewels.com.au
- newamericold.com
- thiebiagt.com

These transfers are indicative of secondary-stage malware delivery, likely expanding functionality or deploying additional components.

ðŸ“¸ **Screenshot placement:** TCP stream size comparison or HTTPS conversations showing large byte counts.

Compare a normal sized packet to the ones infected,normal(figure 1) seems to be 20KB while the infected (figure 2 and 3) show large bytes sizes signaling malicious payloads.

<img width="1854" height="967" alt="3domains_proof2" src="https://github.com/user-attachments/assets/b11f8287-0b59-40c0-ac06-6d171aeab33c" />

<img width="1854" height="967" alt="3domains_proof" src="https://github.com/user-attachments/assets/a131811b-41d8-4123-ab8c-6c9285b4992a" />

<img width="1854" height="967" alt="3domains_proof3" src="https://github.com/user-attachments/assets/8958316c-b85b-45b0-b02a-0dd1a597c62d" />

---

## 7. Command-and-Control Activity (Cobalt Strike)

### 7.1 Identification of Cobalt Strike C2 Servers
Persistent TCP conversations revealed repeated HTTPS GET and POST requests consistent with beaconing behavior. Two external IP addresses were identified as the primary command-and-control servers.

**Cobalt Strike C2 Servers:**
- **IP:** 185.106.96.158  
  **Associated domain:** survmeter.live  
  **Observed Host header:** ocsp.verisign.com (spoofed)

- **IP:** 185.125.204.174  
  **Associated domain:** securitybusinpuff.com

VirusTotal community intelligence confirmed both IPs as Cobalt Strike-related infrastructure.

The use of a legitimate-looking Host header (e.g., `ocsp.verisign.com`) indicates an evasion technique designed to blend malicious traffic with normal TLS/OCSP communications.

ðŸ“¸ **Screenshot placement:** TCP Conversations view highlighting long-lived sessions and Follow TCP Stream output.

<img width="1854" height="967" alt="c2_strike" src="https://github.com/user-attachments/assets/2e96650e-c014-4288-b5f4-3f8d7ac39994" />

<img width="1850" height="923" alt="c2_strike2" src="https://github.com/user-attachments/assets/fdf6cca5-8e5b-48b7-ba34-2f3659aeeeb6" />

<img width="1124" height="491" alt="c2_proof3" src="https://github.com/user-attachments/assets/b6c35226-2d39-4ab1-9b49-17ffafbb08b9" />

---

## 8. Supporting Post-Infection Infrastructure

### 8.1 Additional POST Endpoint
Further analysis of POST requests revealed communication with an additional domain:

- **Domain:** maldivehost.net

This domain is assessed to function as supporting attacker infrastructure, such as a redirector or secondary tasking endpoint, rather than a primary C2 server.

ðŸ“¸ **Screenshot placement:** POST request showing `maldivehost.net` in the Host header.
<img width="1854" height="967" alt="post_traffic" src="https://github.com/user-attachments/assets/03201ebf-40ad-4c25-91ad-116f93da0740" />

---

## 9. Malicious Spam (Malspam) Activity

### 9.1 SMTP Abuse
SMTP traffic analysis revealed that the infected host was involved in sending malicious spam emails.

The first SMTP transaction that initiated actual email delivery contained the following envelope sender:

- **First MAIL FROM address:** [farshin@mailfa.com](mailto:farshin@mailfa.com)

Earlier SMTP commands containing `BODY=8MIME` were determined to be capability negotiation and not actual message submission.

This activity suggests the infected system was leveraged as part of a broader malspam campaign.

ðŸ“¸ **Screenshot placement:** SMTP packet details showing `MAIL FROM:<farshin@mailfa.com>` followed by `RCPT TO` and `DATA`.
<img width="1854" height="967" alt="spam_mail" src="https://github.com/user-attachments/assets/9f0914ce-a636-4139-a946-03c0f9e7c975" />

---

## 10. Indicators of Compromise (IOCs)

### 10.1 Domains
- attirenepal.com
- finejewels.com.au
- newamericold.com
- thiebiagt.com
- survmeter.live
- securitybusinpuff.com
- maldivehost.net
- api.ipify.org (used for reconnaissance)

### 10.2 IP Addresses
- 185.106.96.158 (Cobalt Strike C2)
- 185.125.204.174 (Cobalt Strike C2)

### 10.3 Files
- documents.zip

### 10.4 Email Artifacts
- [farshin@mailfa.com](mailto:farshin@mailfa.com) (MAIL FROM address)

---

## 11. Conclusion
The investigation confirms that Eric Fischerâ€™s workstation was compromised via a malspam-delivered Word document containing malicious macros. The infection progressed through multiple stages, including payload downloads, system reconnaissance, Cobalt Strike command-and-control communications, and abuse of the host for malicious spam distribution.

The attacker demonstrated moderate to advanced tradecraft, including infrastructure redundancy, HTTPS-based beaconing, and header spoofing to evade detection. Immediate remediation actions should include isolating the affected host, blocking identified IOCs, and conducting endpoint forensic analysis to determine persistence mechanisms.

---

## 12. Analyst Notes
This investigation demonstrates the importance of network traffic analysis in identifying multi-stage malware infections and mapping attacker infrastructure. The techniques observed are consistent with real-world threat actor behavior and provide valuable defensive insights.
